<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CryptoCurrency</title>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"
        integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0=" crossorigin="anonymous"></script>

    <script src="https://cdn.jsdelivr.net/npm/web3@latest/dist/web3.min.js"></script>
</head>

<body>

    <div>Home</div>

    <button onclick="buyToken(3)">btn</button>

    <script>
        var instance;
        var Eweb3;
        var account;
        if (window.ethereum) {
            // here goes the request for the metamask
            Eweb3 = new Web3(ethereum);
            console.log("Connected!");
            ethereum.enable();
        }
        // Legacy dapp browsers...
        else if (window.web3) {
            if (web3.currentProvider) {
                window.web3 = new Web3(web3.currentProvider);
            } else {
                window.web3 = new Web3(new Web3.providers.HttpProvider("http://localhost:7545"));
            }
        }
        // Non-dapp browsers...
        else {
            console.log('Non-Ethereum browser detected. You should consider trying MetaMask!');
        }

        $.getJSON("TokenSale.json", function (r) {
            // console.log(r);
            // console.log(Eweb3);
            console.log(Eweb3.version);
            instance = new Eweb3.eth.Contract(r.abi, r.networks[5777].address);
            console.log(instance);
        })

        function getAccount() {
            // Load account data
            Eweb3.eth.getCoinbase(function (err, acnt) {
                if (err === null) {
                    account = acnt;
                    console.log(account);
                }
            })
        }

        function buyToken(noOfToken) {
            Eweb3.eth.getCoinbase(function (err, acnt) {
                if (err === null) {
                    account = acnt;
                    console.log(account);
                }
            })

            instance.methods.buyTokens(noOfToken)
                .send({
                    from: "0xA2C0795d75914e16F184380c45D12b44DbE5BCdD",
                    value: noOfToken * 1000000000000000,
                    gas: 500000 // Gas limit
                })
                .then(result => {
                    console.log(result);
                })
                .catch(e => {
                    alert(JSON.stringify(e));
                })
        }

    </script>
</body>

</html>